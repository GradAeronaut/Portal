Единый утверждённый словарь терминов и идентификаторов

**Sinbad Portal — FINAL (locked)**

Все файлы, модули, таблицы БД и интерфейсы обязаны использовать **только эти названия**.
Единственный источник истины — **этот файл**.

---

## 1. User Identity / Пользовательская идентификация

| Термин            | Поле / ID       | Описание                                                                                                                              |
| ----------------- | --------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| **Public ID**     | `public_id`     | Публичный 6-символьный Base32 ID пользователя. Используется в Beacons, Shape, KNEEBOARD, Gateway.                                   |
| **External ID**   | `external_id`   | Публичный 32-символьный HEX-ID. Используется в сертификатах, карте, логах.                                                            |
| **Kneeboard User ID** | `kneeboard_user_id` | Внутренний ID пользователя в KNEEBOARD (XenForo). Получается при первичном SSO и хранится в `portal_kneeboard_link`.                    |
| **Internal ID**   | —               | Закрытый составной идентификатор пользователя. Формируется как `Public ID` + `Kneeboard User ID` (пример: `DF5H3W-34`). Не хранится в БД. |
| **Full Name**     | `real_name`     | Закрытое имя пользователя, импортируется из платёжных данных.                                                                         |
| **Public Name**   | `public_name`   | Единственное публичное имя пользователя. Видно в Shape, Beacons и KNEEBOARD.                                                        |

---

## 2. User Roles / Роли пользователей (доступ)

| Роль            | Код               | Описание                                     |
| --------------- | ----------------- | -------------------------------------------- |
| Visitor         | `visitor`         | Начальный уровень, только чтение.            |
| Position Lock   | `position_lock`   | Закрепляет место в производственной очереди. |
| Discount Credit | `discount_credit` | Депозит, дающий скидку.                      |
| Sinbad Standard | `sinbad_standard` | Основной уровень участия Sinbad.             |
| Sinbad Premium  | `sinbad_premium`  | Повышенный уровень участия Sinbad.           |
| Moderator       | `moderator`       | Модерация сообщений в KNEEBOARD.           |
| Admin           | `admin`           | Полный контроль системы.                     |

---

## 3. Membership Levels / Финансовые уровни

| Уровень         | Депозит |
| --------------- | ------- |
| Visitor         | 0       |
| Position Lock   | 290     |
| Discount Credit | 490     |
| Sinbad Standard | 3 950   |
| Sinbad Premium  | 7 950   |

### Связанные сущности

| Термин               | Описание                                                                                                       |
| -------------------- | -------------------------------------------------------------------------------------------------------------- |
| **Balance**          | Текущий денежный баланс пользователя в портале.                                                                |
| **Next Level Delta** | Вычисляемый остаток до следующего уровня. Используется в карточках уровней и кнопках PayPal. Не хранится в БД. |

---

## 4. Incentives / Стимулы

**Incentive / Стимул** — универсальная финансовая сущность для скидок, комиссий, вознаграждений и компенсаций.

### Получатели Incentive (экономические роли)

* **Client / Клиент** — скидки, бонусы, кредиты при покупке.
* **Partner / Партнёр** — комиссионные за привлечение и продажи.
* **Seller / Продавец** — вознаграждение за сделку.
* **Contractor / Подрядчик** — выплаты за выполненные работы/услуги.
* **Staff / Сотрудник** — бонусы и премии.
* **Supplier / Поставщик** — компенсации, скидки, бонусы за поставки.

---

## 5. Authentication & Security / Аутентификация и безопасность

| Сущность                   | Поле / Таблица             | Описание                                        |
| -------------------------- | -------------------------- | ----------------------------------------------- |
| Session Token              | `sessions.token`           | Токен авторизации портала.                      |
| Session Expiry             | `sessions.expires_at`      | Время окончания сессии.                         |
| Verification Token         | `users.verification_token` | Подтверждение email.                            |
| **PortalEntry**            | —                          | Единственная точка входа Portal → XenForo. Сервер-сайд механизм принудительной инициализации XF-сессии (`setupUser()`), используемый только Portal. Не является SSO, OAuth или федерацией. Запрещено: прямой логин, регистрация и восстановление пароля в XenForo. |
| 2FA Secret Key             | `user_2fa.secret_key`      | TOTP-секрет.                                    |
| Gateway Log                | `gateway_log`              | Журнал переходов Portal → XenForo.                           |
| **Emergency Admin Access** | —                          | Серверный доступ администратора при отказе PortalEntry. |


---

## 6. Aircraft Identification Plate / Табличка самолёта

| Поле                   | ID                | Описание                                         |
| ---------------------- | ----------------- | ------------------------------------------------ |
| Aircraft Serial Number | `aircraft_serial` | Официальный серийный номер самолёта владельца.   |
| Owner Note             | `owner_note`      | Личная подпись владельца (ограничение по длине). |

Отображается в **Shape Sinbad**.

---

## 7. Sinbad Beacons / Маяки Sinbad

| Сущность              | Поле / ID                     | Описание                                                                              |
| --------------------- | ----------------------------- | ------------------------------------------------------------------------------------- |
| **Beacon Identifier** | `public_id`                   | Маяк идентифицируется **Public ID пользователя**. Отдельного Beacon ID не существует. |
| Beacon Coordinates    | `lat`, `lng`                  | Географические координаты маяка пользователя.                                         |
| **Geo Region Rule**   | `country_code`, `region_code` | Ограничение перемещения маяка (страна / штат).                                        |

---

## 8. Modules & Pages / Модули и страницы

| Модуль         | Путь            | Назначение                                                 |
| -------------- | --------------- | ---------------------------------------------------------- |
| Shape Sinbad   | `shape-sinbad/` | Личный кабинет, привилегии, Beacons, Identification Plate. |
| KNEEBOARD      | `kneeboard/` (публично), `forum/` (внутренне)        | Коммуникационная панель сообщества Sinbad (XenForo).       |
| Sinbad Beacons | `app/map/`      | Карта маяков и логика размещения.                          |
| Shop           | `shop/`         | Покупки, депозиты, услуги.                                 |
| Auth Module    | `auth/`         | Регистрация, вход, восстановление.                         |
| Avatar Module  | `app/avatar/`   | PNG-аватары и fallback-аватары.                            |
| PortalEntry Gateway | `app/gateway/`  | Передача `public_id` и токенов в KNEEBOARD через PortalEntry.              |

---

## 8.1. KNEEBOARD Terminology / Терминология KNEEBOARD

*XenForo используется как движок; терминология форума в проекте — KNEEBOARD / SECTIONS / CASE / POST.*

| Термин     | Описание                                    |
| ---------- | ------------------------------------------- |
| **KNEEBOARD** | Основной раздел коммуникационной панели (вместо Forum / Community / Radio Panel). |
| **SECTIONS**  | Разделы внутри KNEEBOARD (вместо Forums).  |
| **CASE**      | Пользовательские ветки обсуждений (вместо Thread). |
| **POST**      | Отдельное сообщение внутри CASE. |

---

## 9. Files & Assets / Файловая структура

| Сущность            | Путь                                  |
| ------------------- | ------------------------------------- |
| User Avatar PNG     | `/uploads/avatars/{id}.png`           |
| Fallback SVG Avatar | `/app/avatar/view_avatar.php?id={id}` |
| SVG UI              | `/assets/svg/`                        |
| Основные ассеты     | `/assets/`                            |

---

## 10. Database Tables / Таблицы БД

| Таблица             | Назначение                                                        |
| ------------------- | ----------------------------------------------------------------- |
| `users`             | Профили пользователей портала.                                    |
| `sessions`          | Сессии портала.                                                   |
| `gateway_log`       | Журнал переходов Portal → XenForo.                                                       |
| `user_2fa`          | Настройки 2FA.                                                    |
| `portal_kneeboard_link` | Связка `public_id ↔ kneeboard_user_id`, также образующая Internal ID.                               
| `payments`          | История платежей.                                                 |
| `user_geo`          | Геоданные маяков и региональные ограничения (ключ — `public_id`). |

---

## 11. Forbidden Terms / Запрещённые термины

Запрещено использовать в коде, БД, интерфейсе и документации:

* `display_name`
* `nickname`
* `handle`
* `Forum` (использовать: KNEEBOARD)
* `Forums` (использовать: SECTIONS)
* `Thread` (использовать: CASE)
* `Radiopanel` / `Radio Panel` (использовать: KNEEBOARD)
* `Community` (в контексте форума, использовать: KNEEBOARD)
* **SSO** — устаревший термин, не используется в текущей архитектуре Portal ↔ XenForo. Использовать: PortalEntry.
* любые сущности, отсутствующие в этом документе

---

## 12. Developer Rules / Правила для разработчиков

* Новая сущность добавляется **только через обновление этого файла**.
* Код, БД и интерфейсы обязаны строго соответствовать терминам документа.
* При несоответствии **исправляется код**, а не словарь.

